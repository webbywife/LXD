<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
<title>{% if course_title %}{{ course_title }} — {% endif %}Syllabus · SKOOLED-AI</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Plus Jakarta Sans',sans-serif;background:#dce6ec;min-height:100vh;display:flex;flex-direction:column;}
h1,h2,h3,h4{font-family:'Space Grotesk',sans-serif;}

.topbar{background:#0d1f2d;padding:10px 24px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;}
.topbar-brand{font-family:'Space Grotesk',sans-serif;font-size:15px;font-weight:800;color:#fff;letter-spacing:-0.03em;}
.topbar-brand span{color:#00bbd6;}
.topbar-actions{display:flex;gap:8px;}
.btn{padding:7px 18px;border-radius:8px;font-size:12px;font-weight:700;border:none;cursor:pointer;font-family:'Space Grotesk',sans-serif;transition:.2s;}
.btn-outline{background:transparent;border:1.5px solid rgba(255,255,255,0.25);color:#fff;}
.btn-outline:hover{border-color:#fff;}
.btn-cyan{background:#00bbd6;color:#fff;}
.btn-cyan:hover{background:#009bb3;}

.page{padding:28px;display:flex;justify-content:center;}
.error-box{background:#fff;border-radius:12px;padding:48px 36px;text-align:center;max-width:400px;margin:60px auto;box-shadow:0 4px 24px rgba(0,0,0,.08);}
.error-box h2{color:#0d1f2d;margin-bottom:10px;}
.error-box p{color:#6b8fa3;font-size:13px;}

/* ── Syllabus Document — Plain Academic Style ── */
.syldoc{background:#fff;width:100%;max-width:850px;box-shadow:0 4px 40px rgba(0,0,0,.12);font-family:Calibri,'Trebuchet MS','Segoe UI',Arial,sans-serif;font-size:11pt;color:#000;line-height:1.5;padding:30px 36px;}
.syl-doc-hdr{display:grid;grid-template-columns:80px 1fr 80px;gap:12px;align-items:center;border-bottom:2px solid #000;padding-bottom:12px;margin-bottom:14px;}
.syl-logo-box{width:72px;height:72px;border:1px solid #ccc;display:flex;align-items:center;justify-content:center;font-size:9px;color:#999;text-align:center;line-height:1.3;}
.syl-school-center{text-align:center;}
.syl-school-name{font-size:13pt;font-weight:bold;text-transform:uppercase;line-height:1.3;}
.syl-school-college{font-size:11pt;font-weight:bold;margin-top:3px;}
.syl-school-program{font-size:10pt;margin-top:3px;}
.syl-course-block{text-align:center;border:1px solid #000;padding:8px 12px;margin:10px 0 14px;}
.syl-course-code-title{font-size:13pt;font-weight:bold;}
.syl-course-subtitle{font-size:10pt;margin-top:3px;}
.syl-sec-hdr{font-size:11pt;font-weight:bold;text-decoration:underline;margin:18px 0 8px;color:#000;display:block;}
.syl-sec-body{font-size:11pt;line-height:1.65;color:#000;}
.syl-sec-body p{margin-bottom:6px;}
.syl-ci-table{width:100%;border-collapse:collapse;font-size:11pt;margin-bottom:8px;}
.syl-ci-table td{padding:3px 5px;vertical-align:top;}
.syl-ci-label{font-weight:bold;text-transform:uppercase;width:200px;white-space:nowrap;}
.syl-ci-colon{width:14px;text-align:center;}
.syl-ci-value{border-bottom:1px solid #000;min-width:200px;}
.syl-table{width:100%;border-collapse:collapse;font-size:10.5pt;margin:6px 0 12px;}
.syl-table th{border:1px solid #000;padding:6px 8px;text-align:left;font-weight:bold;background:#fff;color:#000;}
.syl-table td{border:1px solid #000;padding:5px 8px;vertical-align:top;color:#000;background:#fff;}
.syl-plan-wrap{overflow-x:auto;margin:6px 0 12px;}
.syl-plan-table{width:100%;border-collapse:collapse;font-size:9pt;min-width:800px;}
.syl-plan-table th{border:1px solid #000;padding:5px 6px;text-align:center;font-weight:bold;background:#fff;color:#000;white-space:nowrap;}
.syl-plan-table td{border:1px solid #000;padding:5px 6px;vertical-align:top;color:#000;background:#fff;line-height:1.4;}
.wk-num{text-align:center;font-weight:bold;}
.syl-grade-table{border-collapse:collapse;font-size:10.5pt;margin:6px 0 12px;min-width:320px;}
.syl-grade-table th{border:1px solid #000;padding:5px 10px;font-weight:bold;background:#fff;color:#000;text-align:left;}
.syl-grade-table td{border:1px solid #000;padding:5px 10px;color:#000;background:#fff;}
.wt{font-weight:bold;text-align:right;}
.syl-grade-total td{font-weight:bold;border-top:2px solid #000;}
.syl-refs{padding-left:20px;margin:4px 0 10px;}
.syl-refs li{font-size:10.5pt;line-height:1.6;margin-bottom:2px;}
.syl-refs-sub{font-weight:bold;font-size:10.5pt;margin:10px 0 4px;}
.syl-sig{display:grid;grid-template-columns:1fr 1fr;gap:40px;margin-top:30px;padding-top:14px;border-top:1px solid #000;}
.syl-sig-box{text-align:center;}
.syl-sig-line{border-bottom:1px solid #000;margin:0 10px 5px;height:40px;}
.syl-sig-name{font-size:10.5pt;font-weight:bold;color:#000;}
.syl-sig-role{font-size:9.5pt;color:#000;}

/* Print handled by printDoc() clean-window function */
</style>
</head>
<body>

<div class="topbar">
  <div class="topbar-brand">SKOOLED<span>-AI</span></div>
  <div class="topbar-actions">
    {% if can_edit and syllabus_token %}
    <a href="/syllabus?load={{ syllabus_token }}{% if auth_token %}&_t={{ auth_token }}{% endif %}" class="btn btn-cyan">Edit Syllabus</a>
    {% endif %}
    <button class="btn btn-outline" onclick="printDoc()">Print / Save PDF</button>
  </div>
</div>

{% if error %}
<div class="error-box">
  <h2>Syllabus Not Found</h2>
  <p>{{ error }}</p>
</div>
{% else %}
<div class="page">
  <div class="syldoc" id="syldoc"></div>
</div>

<script>
const S = {{ syllabus | tojson | safe }};

function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function nl2p(s){return s?s.split(/\n+/).filter(l=>l.trim()).map(l=>`<p>${esc(l.trim())}</p>`).join(''):'<p style="color:#999;font-style:italic">Not provided</p>';}

function render(){
  const s=S;
  let h='';

  // Three-column document header
  h+=`<div class="syl-doc-hdr">
    <div class="syl-logo-box">Logo</div>
    <div class="syl-school-center">
      <div class="syl-school-name">${esc(s.school_name||'[School / University Name]')}</div>
      <div class="syl-school-college">${esc(s.college_dept||'[College / Department]')}</div>
      <div class="syl-school-program">${esc(s.program||'[Program]')}</div>
    </div>
    <div class="syl-logo-box">Seal</div>
  </div>`;

  // Course title block
  const code=s.course_code?(s.course_code+' \u2014 '):'';
  h+=`<div class="syl-course-block">
    <div class="syl-course-code-title">${esc(code+(s.course_title||'[Course Title]'))}</div>
    ${s.semester?`<div class="syl-course-subtitle">${esc(s.semester)}</div>`:''}
  </div>`;

  // Course Information (key:value)
  const ciRows=[
    ['COURSE CODE',s.course_code||''],['COURSE TITLE',s.course_title||''],
    ['CREDIT UNITS',s.credits||''],['COURSE TYPE',s.course_type||''],
    ['PREREQUISITES',s.prerequisites||'None'],['ACADEMIC PERIOD',s.semester||''],
    ['NAME OF FACULTY',''],['SCHEDULE',''],['CONSULTATION TIME',''],
  ];
  h+=`<div class="syl-sec-hdr">Course Information</div>
    <table class="syl-ci-table"><tbody>${ciRows.map(([l,v])=>`<tr><td class="syl-ci-label">${l}</td><td class="syl-ci-colon">:</td><td class="syl-ci-value">${esc(v)}</td></tr>`).join('')}</tbody></table>`;

  // Course Description
  h+=`<div class="syl-sec-hdr">Course Description</div><div class="syl-sec-body">${nl2p(s.course_description)}</div>`;

  // Program Outcomes
  if(s.program_outcomes&&s.program_outcomes.length){
    h+=`<div class="syl-sec-hdr">Program Outcomes</div>
      <ul class="syl-refs">${s.program_outcomes.map(po=>`<li><strong>${esc(po.code)}:</strong> ${esc(po.description)}</li>`).join('')}</ul>`;
  }

  // Course Outcomes
  if(s.course_outcomes&&s.course_outcomes.length){
    h+=`<div class="syl-sec-hdr">Course Outcomes</div>
      <table class="syl-table"><thead><tr>
        <th style="width:60px;text-align:center">Code</th>
        <th>Course Outcome Statement</th>
        <th style="width:110px;text-align:center">PO Mapping</th>
      </tr></thead><tbody>${s.course_outcomes.map(co=>`<tr>
        <td style="text-align:center;font-weight:bold">${esc(co.code)}</td>
        <td>${esc(co.description)}</td>
        <td style="text-align:center">\u2014</td>
      </tr>`).join('')}</tbody></table>`;
  }

  // Course Plan
  if(s.course_plan&&s.course_plan.length){
    const rows=s.course_plan.map(w=>`<tr>
      <td class="wk-num">${esc(String(w.week||''))}</td>
      <td>${esc(w.topics||'')}</td><td>${esc(w.ilos||'')}</td>
      <td>${esc(w.tlas||'')}</td><td>${esc(w.assessment_tasks||'')}</td>
      <td>${esc(w.evaluation_strategies||'')}</td>
      <td>${esc(w.resources||'')}</td><td>${esc(w.due_date||'')}</td>
    </tr>`).join('');
    h+=`<div class="syl-sec-hdr">Course Plan</div>
      <div class="syl-plan-wrap"><table class="syl-plan-table">
        <thead><tr>
          <th style="width:36px">Week</th><th>Topics</th><th>ILOs</th>
          <th>TLAs</th><th>Assessment Tasks</th><th>Evaluation</th>
          <th>Resources</th><th>Due Date</th>
        </tr></thead><tbody>${rows}</tbody>
      </table></div>`;
  }

  // Grading
  if(s.grading_system&&s.grading_system.length){
    let total=0;
    const gRows=s.grading_system.map(g=>{total+=parseInt(g.weight||0);return`<tr><td>${esc(g.component)}</td><td class="wt">${esc(String(g.weight))}%</td></tr>`;}).join('');
    h+=`<div class="syl-sec-hdr">Grading System</div>
      <table class="syl-grade-table"><thead><tr><th>Component</th><th>Weight</th></tr></thead>
      <tbody>${gRows}<tr class="syl-grade-total"><td>TOTAL</td><td class="wt">${total}%</td></tr></tbody></table>
      <p style="font-size:10.5pt;margin-top:6px">Passing grade: <strong>70%</strong>. Grading is cumulative and zero-based.</p>`;
  }

  // Academic Policies
  h+=`<div class="syl-sec-hdr">Academic Policies</div>
    <div class="syl-sec-body">
      <p><strong>Attendance:</strong> Minimum 80% required. Exceeding 20% absences may result in INC or DRP.</p>
      <p><strong>Academic Integrity:</strong> All outputs must be original work. Plagiarism results in a failing grade.</p>
      <p><strong>Netiquette:</strong> Respectful behavior required in all class interactions.</p>
      <p><strong>Intellectual Property:</strong> Course materials may not be reproduced without consent.</p>
    </div>`;

  // References
  if(s.references){
    const books=s.references.books||[];
    const sites=s.references.websites||[];
    if(books.length||sites.length){
      h+='<div class="syl-sec-hdr">References</div>';
      if(books.length) h+='<div class="syl-refs-sub">Books &amp; Journals</div><ul class="syl-refs">'+books.map(b=>`<li>${esc(b)}</li>`).join('')+'</ul>';
      if(sites.length) h+='<div class="syl-refs-sub" style="margin-top:10px">Online Resources</div><ul class="syl-refs">'+sites.map(b=>`<li>${esc(b)}</li>`).join('')+'</ul>';
    }
  }

  // Signatures
  h+=`<div class="syl-sig">
    <div class="syl-sig-box"><div class="syl-sig-line"></div><div class="syl-sig-name">[Faculty Name]</div><div class="syl-sig-role">Prepared by \u2014 Course Instructor</div></div>
    <div class="syl-sig-box"><div class="syl-sig-line"></div><div class="syl-sig-name">[Department Head / Dean]</div><div class="syl-sig-role">Approved by \u2014 Academic Head</div></div>
  </div>`;

  document.getElementById('syldoc').innerHTML=h;
}
render();

function printDoc(){
  const syldoc=document.getElementById('syldoc');
  if(!syldoc) return;
  const w=window.open('','_blank','width=900,height=700');
  w.document.write(`<!DOCTYPE html>
<html lang="en"><head>
<meta charset="UTF-8">
<title>Syllabus</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{background:#fff;font-family:Calibri,'Trebuchet MS','Segoe UI',Arial,sans-serif;font-size:11pt;color:#000;}
@page{size:A4 landscape;margin:15mm;}
.syldoc{width:100%;font-family:Calibri,'Trebuchet MS','Segoe UI',Arial,sans-serif;font-size:11pt;color:#000;line-height:1.5;}
.syl-doc-hdr{display:grid;grid-template-columns:80px 1fr 80px;gap:12px;align-items:center;border-bottom:2px solid #000;padding-bottom:12px;margin-bottom:14px;}
.syl-logo-box{width:72px;height:72px;border:1px solid #ccc;display:flex;align-items:center;justify-content:center;font-size:9px;color:#999;text-align:center;line-height:1.3;}
.syl-school-center{text-align:center;}
.syl-school-name{font-size:13pt;font-weight:bold;text-transform:uppercase;line-height:1.3;}
.syl-school-college{font-size:11pt;font-weight:bold;margin-top:3px;}
.syl-school-program{font-size:10pt;margin-top:3px;}
.syl-course-block{text-align:center;border:1px solid #000;padding:8px 12px;margin:10px 0 14px;}
.syl-course-code-title{font-size:13pt;font-weight:bold;}
.syl-course-subtitle{font-size:10pt;margin-top:3px;}
.syl-sec-hdr{font-size:11pt;font-weight:bold;text-decoration:underline;margin:18px 0 8px;color:#000;display:block;page-break-after:avoid;}
.syl-sec-body{font-size:11pt;line-height:1.65;color:#000;}
.syl-sec-body p{margin-bottom:6px;}
.syl-ci-table{width:100%;border-collapse:collapse;font-size:11pt;margin-bottom:8px;}
.syl-ci-table td{padding:3px 5px;vertical-align:top;}
.syl-ci-label{font-weight:bold;text-transform:uppercase;width:200px;white-space:nowrap;}
.syl-ci-colon{width:14px;text-align:center;}
.syl-ci-value{border-bottom:1px solid #000;min-width:200px;}
.syl-table{width:100%;border-collapse:collapse;font-size:10.5pt;margin:6px 0 12px;}
.syl-table th{border:1px solid #000;padding:6px 8px;text-align:left;font-weight:bold;background:#fff;color:#000;}
.syl-table td{border:1px solid #000;padding:5px 8px;vertical-align:top;color:#000;background:#fff;}
.syl-plan-wrap{margin:6px 0 12px;}
.syl-plan-table{width:100%;border-collapse:collapse;font-size:8pt;}
.syl-plan-table th{border:1px solid #000;padding:4px 5px;text-align:center;font-weight:bold;background:#fff;color:#000;white-space:nowrap;}
.syl-plan-table td{border:1px solid #000;padding:4px 5px;vertical-align:top;color:#000;background:#fff;line-height:1.35;}
.wk-num{text-align:center;font-weight:bold;}
.syl-grade-table{border-collapse:collapse;font-size:10.5pt;margin:6px 0 12px;min-width:320px;}
.syl-grade-table th{border:1px solid #000;padding:5px 10px;font-weight:bold;background:#fff;color:#000;text-align:left;}
.syl-grade-table td{border:1px solid #000;padding:5px 10px;color:#000;background:#fff;}
.wt{font-weight:bold;text-align:right;}
.syl-grade-total td{font-weight:bold;border-top:2px solid #000;}
.syl-refs{padding-left:20px;margin:4px 0 10px;}
.syl-refs li{font-size:10.5pt;line-height:1.6;margin-bottom:2px;}
.syl-refs-sub{font-weight:bold;font-size:10.5pt;margin:10px 0 4px;}
.syl-sig{display:grid;grid-template-columns:1fr 1fr;gap:40px;margin-top:30px;padding-top:14px;border-top:1px solid #000;page-break-inside:avoid;}
.syl-sig-box{text-align:center;}
.syl-sig-line{border-bottom:1px solid #000;margin:0 10px 5px;height:40px;}
.syl-sig-name{font-size:10.5pt;font-weight:bold;color:#000;}
.syl-sig-role{font-size:9.5pt;color:#000;}
</style>
</head><body>
<div class="syldoc">${syldoc.innerHTML}</div>
</body></html>`);
  w.document.close();
  w.focus();
  setTimeout(()=>{ w.print(); },600);
}
</script>
{% endif %}
</body>
</html>
